<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Created by Ant-WEB S.L.
 * User: Xabier Fern&aacute;ndez Rodr&iacute;guez &lt;jjbier@gmail.com&gt;
 * Date: 11/10/13
 * Time: 12:03
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

namespace Ant\ChateaClient\Client;

use Ant\ChateaClient\Service\Client\ChateaOAuth2Client;
use Ant\ChateaClient\Service\Client\AuthenticationException;
use Guzzle\Http\Exception\BadResponseException;
use Guzzle\Http\Exception\ClientErrorResponseException;
use Guzzle\Http\Exception\CurlException;

class Authentication
{

    private $client;

    function __construct(ChateaOAuth2Client $client)
    {
        $this-&gt;client = $client;

    }

    /**
     * @return \Ant\ChateaClient\Service\Client\ChateaOAuth2Client
     */
    public function getClient()
    {
        return $this-&gt;client;
    }

    /**
     * @return string
     */
    public function getClientId()
    {
        return $this-&gt;client-&gt;getClientId();
    }

    /**
     * @return string
     */
    public function getSecret()
    {
        return $this-&gt;client-&gt;getSecret();
    }


    public function withUserCredentials($username, $password)
    {
        if (!is_string($username) || 0 &gt;= strlen($username)) {
            throw new InvalidArgumentException(&quot;username must be a non-empty string&quot;);
        }
        if (!is_string($password) || 0 &gt;= strlen($password)) {
            throw new InvalidArgumentException(&quot;password must be a non-empty string&quot;);
        }

        /* @var $command Guzzle\Service\Command\AbstractCommand */
        $command = $this-&gt;client-&gt;getCommand('withUserCredentials',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'username'=&gt;$username,'password'=&gt;$password)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }

    }

    public function withAuthorizationCode($auth_code, $redirect_uri)
    {
        if (!is_string($auth_code) || 0 &gt;= strlen($auth_code)) {
            throw new InvalidArgumentException(&quot;auth_code must be a non-empty string&quot;);
        }

        if (!is_string($redirect_uri) || 0 &gt;= strlen($redirect_uri)) {
            throw new InvalidArgumentException(&quot;redirect_uri must be a non-empty string&quot;);
        }

        /* @var $command Guzzle\Service\Command\AbstractCommand */
        $command = $this-&gt;client-&gt;getCommand('withAuthorizationCode',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'redirect_uri'=&gt;$redirect_uri,'code'=&gt;$auth_code)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function withClientCredentials()
    {
        /* @var $command Guzzle\Service\Command\AbstractCommand */
        $command = $this-&gt;client-&gt;getCommand('withClientCredentials',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret())
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function withRefreshToken($refresh_token)
    {
        if (!is_string($refresh_token) || 0 &gt;= strlen($refresh_token)) {
            throw new InvalidArgumentException(&quot;refresh_token must be a non-empty string&quot;);
        }

        /* @var $command Guzzle\Service\Command\AbstractCommand */
        $command = $this-&gt;client-&gt;getCommand('withRefreshToken',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'refresh_token'=&gt;$refresh_token)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function revokeToken()
    {
        $command = $this-&gt;client-&gt;getCommand('RevokeToken');
        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }
}</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>