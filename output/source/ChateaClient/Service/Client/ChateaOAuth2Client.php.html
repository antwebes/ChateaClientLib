<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Created by JetBrains PhpStorm.
 * User: xabier
 * Date: 10/10/13
 * Time: 23:31
 * To change this template use File | Settings | File Templates.
 */

namespace Ant\ChateaClient\Service\Client;

use Guzzle\Common\Collection;
use Guzzle\Service\Description\ServiceDescription;
use Ant\Guzzle\Plugin\AcceptHeaderPluging;

class ChateaOAuth2Client extends Client
{

    public static function factory($config = array())
    {
        // Provide a hash of default client configuration options
        $default = array(
            'base_url'=&gt;'{scheme}://{subdomain}.chateagratis.local',
            'Accept'=&gt;'application/json',
            'environment'=&gt;'prod',
            'scheme' =&gt; 'https',
            'version'=&gt;'',
            'subdomain'=&gt;'api',
            'service-description-name' =&gt; Client::NAME_SERVICE_AUTH
        );
        $required = array(
            'base_url',
            'scheme',
            'subdomain',
            'Accept',
            'environment',
            'client_id',
            'secret'
        );

        // Merge in default settings and validate the config
        $config = Collection::fromConfig($config, $default, $required);

        if($config['environment'] == 'dev' ){
            $config['base_url'] = $config['base_url'] . '/app_dev.php';
            $config['scheme'] = 'http';
            $config['ssl.certificate_authority'] = 'system';
            $config['curl.options'] = array(CURLOPT_SSL_VERIFYHOST=&gt;false,CURLOPT_SSL_VERIFYPEER=&gt;false);
        }


        // Create a new ChateaOAuth2 client
        $client = new ChateaOAuth2Client ($config-&gt;get('base_url'),
            $config-&gt;get('scheme'),
            $config-&gt;get('subdomain'),
            $config
        );
        $client-&gt;addSubscriber(new AcceptHeaderPluging($config-&gt;toArray()));
        return $client;
    }

    /**
     * @return string
     */
    public function getClientId()
    {
        return $this-&gt;getConfig('client_id');
    }

    /**
     * @return string
     */
    public function getSecret()
    {
        return $this-&gt;getConfig('secret');
    }


    public function withUserCredentials($username, $password)
    {
        if (!is_string($username) || 0 &gt;= strlen($username)) {
            throw new InvalidArgumentException(&quot;username must be a non-empty string&quot;);
        }
        if (!is_string($password) || 0 &gt;= strlen($password)) {
            throw new InvalidArgumentException(&quot;password must be a non-empty string&quot;);
        }

        $command = $this-&gt;getCommand('withUserCredentials',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'username'=&gt;$username,'password'=&gt;$password)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }

    }

    public function withAuthorizationCode($auth_code, $redirect_uri)
    {
        if (!is_string($auth_code) || 0 &gt;= strlen($auth_code)) {
            throw new InvalidArgumentException(&quot;auth_code must be a non-empty string&quot;);
        }

        if (!is_string($redirect_uri) || 0 &gt;= strlen($redirect_uri)) {
            throw new InvalidArgumentException(&quot;redirect_uri must be a non-empty string&quot;);
        }

        $command = $this-&gt;getCommand('withAuthorizationCode',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'redirect_uri'=&gt;$redirect_uri,'code'=&gt;$auth_code)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function withClientCredentials()
    {
        $command = $this-&gt;getCommand('withClientCredentials',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret())
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function withRefreshToken($refresh_token)
    {
        if (!is_string($refresh_token) || 0 &gt;= strlen($refresh_token)) {
            throw new InvalidArgumentException(&quot;refresh_token must be a non-empty string&quot;);
        }

        $command = $this-&gt;getCommand('withRefreshToken',
            array('client_id'=&gt;$this-&gt;getClientId(),'client_secret'=&gt;$this-&gt;getSecret(),'refresh_token'=&gt;$refresh_token)
        );

        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }

    public function revokeToken()
    {
        $command = $this-&gt;getCommand('RevokeToken');
        try{
            return $command-&gt;execute();
        }catch (BadResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(ClientErrorResponseException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }catch(CurlException $ex){
            throw new AuthenticationException($ex-&gt;getMessage(), 400, $ex);
        }
    }
}</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>